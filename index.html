<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Katakana Typing Practice - Blue Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #00a8cc;
            --soft-blue: #e0f7fa;
            --border-blue: #b2ebf2;
            --accent-blue: #007c91;
            --text-color: #37474f;
            --target-mark: #ff5252;
        }

        body { 
            font-family: "UD Digital Kyokasho N-R", "UD ãƒ‡ã‚¸ã‚¿ãƒ« æ•™ç§‘æ›¸ä½“ N-R", "BIZ UDPGothic", "Zen Maru Gothic", sans-serif; 
            background-color: var(--soft-blue); 
            color: var(--text-color); 
            margin: 0; 
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .app-card {
            background: white;
            flex: 1;
            display: flex;
            flex-direction: column;
            margin: 5px;
            border-radius: 15px;
            padding: 8px;
            border: 2px solid var(--border-blue);
            box-sizing: border-box;
            min-height: 0;
        }

        .app-title {
            font-size: 20px;
            text-align: center;
            color: var(--text-color);
            margin: 5px 0 10px 0;
            letter-spacing: 2px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .top-chart-section {
            flex: 1; 
            display: flex;
            flex-direction: column;
            background: #f0fdff;
            border-radius: 12px;
            padding: 5px;
            border: 1px solid var(--border-blue);
            min-height: 0;
        }

        .tab-menu { display: flex; justify-content: center; gap: 8px; margin-bottom: 5px; flex-wrap: wrap; }
        .tab-menu button {
            font-family: inherit; padding: 4px 12px; font-size: 13px; cursor: pointer;
            border-radius: 10px; border: 2px solid var(--border-blue); background: white; color: var(--primary-blue); font-weight: bold;
        }
        .tab-menu button.active-btn { background: var(--primary-blue); color: white; }
        
        .tab-menu button#btn-challenge { border-color: #37474f; color: #37474f; }
        .tab-menu button#btn-challenge.challenge-on { background: #37474f; color: white; }

        .chart-display-area { 
            flex: 1; 
            overflow-y: auto; 
            display: flex; 
            flex-direction: column;
            align-items: center;
            gap: 15px;
            padding: 10px 0;
            scroll-behavior: smooth;
        }
        
        table { border-collapse: separate; border-spacing: 2px; background: white; border-radius: 8px; }
        td { 
            border: 1px solid #e0f2f1; width: 42px; height: 42px; text-align: center; border-radius: 6px; 
            background: #fff; position: relative;
        }
        
        .challenge-mode-active td:not(.vowel-label):not(.empty-col) .kana,
        .challenge-mode-active td:not(.vowel-label):not(.empty-col) .romaji {
            visibility: hidden;
        }
        .challenge-mode-active td:not(.vowel-label):not(.empty-col)::after {
            content: "?"; color: #cfd8dc; font-size: 14px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        }

        .show-cell .kana, .show-cell .romaji { visibility: visible !important; }
        .show-cell::after { display: none !important; }

        .target-cell { border: 3px solid var(--target-mark) !important; background-color: #fff9f9 !important; z-index: 5; }
        .vowel-label { background: var(--soft-blue); color: var(--accent-blue); font-size: 13px; font-weight: bold; width: 25px; border: none; }
        .kana { font-size: 18px; font-weight: 700; color: #333; display: block; line-height: 1; }
        .romaji { font-size: 9px; color: var(--primary-blue); display: block; opacity: 0.8; }

        .bottom-quiz-section {
            height: 180px; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #fff;
            border-top: 2px solid var(--soft-blue);
            padding: 10px;
            gap: 5px;
            position: relative;
        }

        .score-box { position: absolute; top: 10px; right: 20px; font-size: 14px; font-weight: bold; color: var(--accent-blue); }
        #question { font-size: 70px; color: var(--primary-blue); margin: 0; font-weight: bold; line-height: 1; }
        .input-wrapper { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        #answer-input { font-family: inherit; font-size: 24px; padding: 8px; width: 160px; text-align: center; border: 2px solid var(--border-blue); border-radius: 20px; outline: none; }
        .action-btn { padding: 8px 30px; font-size: 16px; font-weight: bold; background: var(--primary-blue); color: white; border: none; border-radius: 15px; cursor: pointer; transition: transform 0.1s; }
        #next-btn { display: none; background: #4caf50; }
        #feedback { font-size: 16px; font-weight: bold; height: 20px; }
    </style>
</head>
<body>

<div class="app-card">
    <h1 class="app-title">Katakana Typing</h1>

    <div class="top-chart-section">
        <div class="tab-menu">
            <button id="btn-basic" onclick="setMode('basic')">Basic</button>
            <button id="btn-contracted" onclick="setMode('contracted')">Contracted</button>
            <button id="btn-foreign" onclick="setMode('foreign')">Foreign</button>
            <button id="btn-mix" onclick="setMode('mix')">MIX</button>
            <button id="btn-challenge" onclick="toggleChallenge()">Challenge âœ¨ OFF</button>
        </div>
        <div id="display-area" class="chart-display-area">
            <div id="chart-container"></div>
        </div>
    </div>

    <div class="bottom-quiz-section">
        <div class="score-box">Correct: <span id="score-count">0</span></div>
        <div id="question">?</div>
        <div class="input-wrapper">
            <input type="text" id="answer-input" placeholder="Type..." autocomplete="off">
            <div id="feedback"></div>
            <div class="btn-group">
                <button id="check-btn" class="action-btn" onclick="check()">OK (Enter)</button>
                <button id="next-btn" class="action-btn" onclick="nextQuestion()">Next (Enter)</button>
            </div>
        </div>
    </div>
</div>

<script>
    const charts = {
        basic: [[0,0,"ã‚¢","a"],[0,1,"ã‚¤","i"],[0,2,"ã‚¦","u"],[0,3,"ã‚¨","e"],[0,4,"ã‚ª","o"],[1,0,"ã‚«","ka"],[1,1,"ã‚­","ki"],[1,2,"ã‚¯","ku"],[1,3,"ã‚±","ke"],[1,4,"ã‚³","ko"],[2,0,"ã‚µ","sa"],[2,1,"ã‚·","shi"],[2,2,"ã‚¹","su"],[2,3,"ã‚»","se"],[2,4,"ã‚½","so"],[3,0,"ã‚¿","ta"],[3,1,"ãƒ","chi"],[3,2,"ãƒ„","tsu"],[3,3,"ãƒ†","te"],[3,4,"ãƒˆ","to"],[4,0,"ãƒŠ","na"],[4,1,"ãƒ‹","ni"],[4,2,"ãƒŒ","nu"],[4,3,"ãƒ","ne"],[4,4,"ãƒŽ","no"],[5,0,"ãƒ","ha"],[5,1,"ãƒ’","hi"],[5,2,"ãƒ•","fu"],[5,3,"ãƒ˜","he"],[5,4,"ãƒ›","ho"],[6,0,"ãƒž","ma"],[6,1,"ãƒŸ","mi"],[6,2,"ãƒ ","mu"],[6,3,"ãƒ¡","me"],[6,4,"ãƒ¢","mo"],[7,0,"ãƒ¤","ya"],[7,2,"ãƒ¦","yu"],[7,4,"ãƒ¨","yo"],[8,0,"ãƒ©","ra"],[8,1,"ãƒª","ri"],[8,2,"ãƒ«","ru"],[8,3,"ãƒ¬","re"],[8,4,"ãƒ­","ro"],[9,0,"ãƒ¯","wa"],[9,2,"ãƒ²","wo"],[9,4,"ãƒ³","nn"],[11,0,"ã‚¬","ga"],[11,1,"ã‚®","gi"],[11,2,"ã‚°","gu"],[11,3,"ã‚²","ge"],[11,4,"ã‚´","go"],[12,0,"ã‚¶","za"],[12,1,"ã‚¸","ji"],[12,2,"ã‚º","zu"],[12,3,"ã‚¼","ze"],[12,4,"ã‚¾","zo"],[13,0,"ãƒ€","da"],[13,1,"ãƒ‚","ji"],[13,2,"ãƒ…","zu"],[13,3,"ãƒ‡","de"],[13,4,"ãƒ‰","do"],[14,0,"ãƒ","ba"],[14,1,"ãƒ“","bi"],[14,2,"ãƒ–","bu"],[14,3,"ãƒ™","be"],[14,4,"ãƒœ","bo"],[15,0,"ãƒ‘","pa"],[15,1,"ãƒ”","pi"],[15,2,"ãƒ—","pu"],[15,3,"ãƒš","pe"],[15,4,"ãƒ","po"]],
        contracted: [[0,0,"ã‚­ãƒ£","kya"],[0,2,"ã‚­ãƒ¥","kyu"],[0,4,"ã‚­ãƒ§","kyo"],[1,0,"ã‚·ãƒ£","sya"],[1,2,"ã‚·ãƒ¥","syu"],[1,4,"ã‚·ãƒ§","syo"],[2,0,"ãƒãƒ£","cya"],[2,2,"ãƒãƒ¥","cyu"],[2,4,"ãƒãƒ§","cyo"],[3,0,"ãƒ‹ãƒ£","nya"],[3,2,"ãƒ‹ãƒ¥","nyu"],[3,4,"ãƒ‹ãƒ§","nyo"],[4,0,"ãƒ’ãƒ£","hya"],[4,2,"ãƒ’ãƒ¥","hyu"],[4,4,"ãƒ’ãƒ§","hyo"],[5,0,"ãƒŸãƒ£","mya"],[5,2,"ãƒŸãƒ¥","myu"],[5,4,"ãƒŸãƒ§","myo"],[6,0,"ãƒªãƒ£","rya"],[6,2,"ãƒªãƒ¥","ryu"],[6,4,"ãƒªãƒ§","ryo"],[8,0,"ã‚®ãƒ£","gya"],[8,2,"ã‚®ãƒ¥","gyu"],[8,4,"ã‚®ãƒ§","gyo"],[9,0,"ã‚¸ãƒ£","zya"],[9,2,"ã‚¸ãƒ¥","zyu"],[9,4,"ã‚¸ãƒ§","zyo"],[10,0,"ãƒ“ãƒ£","bya"],[10,2,"ãƒ“ãƒ¥","byu"],[10,4,"ãƒ“ãƒ§","byo"],[11,0,"ãƒ”ãƒ£","pya"],[11,2,"ãƒ”ãƒ¥","pyu"],[11,4,"ãƒ”ãƒ§","pyo"]],
        foreign: [[0,0,"ãƒ•ã‚¡","fa"],[0,1,"ãƒ•ã‚£","fi"],[0,3,"ãƒ•ã‚§","fe"],[0,4,"ãƒ•ã‚©","fo"],[1,1,"ãƒ†ã‚£","thi"],[2,3,"ãƒã‚§","che"],[3,1,"ãƒ‡ã‚£","dhi"],[3,2,"ãƒ‡ãƒ¥","dhu"],[5,3,"ã‚¸ã‚§","je"],[6,3,"ã‚·ã‚§","she"],[8,0,"ãƒ´ã‚¡","va"],[8,1,"ãƒ´ã‚£","vi"],[8,2,"ãƒ´","vu"],[8,3,"ãƒ´ã‚§","ve"],[8,4,"ãƒ´ã‚©","vo"],[9,1,"ã‚¦ã‚£","wi"],[9,3,"ã‚¦ã‚§","we"],[9,4,"ã‚¦ã‚©","who"]]
    };

    let currentCategory = 'basic'; 
    let currentQ = null; 
    let score = 0;
    let isChallengeMode = false;

    function renderSingleTable(mode, labelText) {
        const list = charts[mode];
        const maxCol = Math.max(...list.map(d => d[0]));
        const labels = (mode === 'contracted') ? ["ya","","yu","","yo"] : ["a","i","u","e","o"];
        let html = `<div><small style="color:var(--primary-blue); font-weight:bold;">${labelText}</small><table>`;
        for (let r = 0; r < 5; r++) {
            html += `<tr><td class="vowel-label">${labels[r]}</td>`;
            for (let c = 0; c <= maxCol; c++) {
                const item = list.find(d => d[0] === c && d[1] === r);
                if (item) { html += `<td id="cell-${mode}-${c}-${r}"><span class="kana">${item[2]}</span><span class="romaji">${item[3]}</span></td>`; }
                else { html += '<td class="empty-col" style="border:none;background:none;"></td>'; }
            }
            html += '</tr>';
        }
        return html + '</table></div>';
    }

    function setMode(category) {
        currentCategory = category;
        const container = document.getElementById('chart-container');
        document.querySelectorAll('.tab-menu button').forEach(b => {
            if(b.id !== 'btn-challenge') b.classList.remove('active-btn');
        });
        document.getElementById('btn-' + category).classList.add('active-btn');
        
        if (category === 'mix') {
            container.innerHTML = renderSingleTable('basic', 'Basic') + renderSingleTable('contracted', 'Contracted') + renderSingleTable('foreign', 'Foreign');
        } else {
            container.innerHTML = renderSingleTable(category, category.toUpperCase());
        }
        nextQuestion();
    }

    function toggleChallenge() {
        isChallengeMode = !isChallengeMode;
        const btn = document.getElementById('btn-challenge');
        const displayArea = document.getElementById('display-area');
        
        if (isChallengeMode) {
            btn.classList.add('challenge-on');
            btn.innerText = "Challenge âœ¨ ON";
            displayArea.classList.add('challenge-mode-active');
        } else {
            btn.classList.remove('challenge-on');
            btn.innerText = "Challenge âœ¨ OFF";
            displayArea.classList.remove('challenge-mode-active');
        }
        document.querySelectorAll('td').forEach(td => td.classList.remove('target-cell', 'show-cell'));
    }

    function showTargetCell(isForceShow) {
        document.querySelectorAll('td').forEach(td => td.classList.remove('target-cell', 'show-cell'));
        const cellId = `cell-${currentQ.sourceMode}-${currentQ.data[0]}-${currentQ.data[1]}`;
        const targetCell = document.getElementById(cellId);
        if (targetCell) {
            targetCell.classList.add('target-cell');
            if (isForceShow) targetCell.classList.add('show-cell');
            targetCell.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }

    function nextQuestion() {
        let sourceMode = (currentCategory === 'mix') ? ['basic', 'contracted', 'foreign'][Math.floor(Math.random() * 3)] : currentCategory;
        const source = charts[sourceMode];
        currentQ = { data: source[Math.floor(Math.random() * source.length)], sourceMode: sourceMode };
        document.getElementById('question').innerText = currentQ.data[2];
        const input = document.getElementById('answer-input');
        input.value = ''; input.disabled = false; input.focus();
        document.getElementById('feedback').innerText = '';
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('check-btn').style.display = 'inline-block';
        
        document.querySelectorAll('td').forEach(td => td.classList.remove('target-cell', 'show-cell'));
    }

    function check() {
        const val = document.getElementById('answer-input').value.toLowerCase().trim();
        if(!val) return;

        const kana = currentQ.data[2];
        const ans = currentQ.data[3];

        let isCorrect = (val === ans);
        if (!isCorrect) {
            // ã“ã“ã‚’ã‚«ã‚¿ã‚«ãƒŠã«å¤‰æ›´ã—ã¾ã—ãŸ
            const alt = {
                'ã‚·': ['si'], 'ã‚·ãƒ£': ['sya'], 'ã‚·ãƒ¥': ['syu'], 'ã‚·ãƒ§': ['syo'],
                'ãƒ': ['ti'], 'ãƒãƒ£': ['tya', 'cya'], 'ãƒãƒ¥': ['tyu', 'cyu'], 'ãƒãƒ§': ['tyo', 'cyo'],
                'ãƒ„': ['tu'], 'ãƒ•': ['hu'],
                'ã‚¸': ['zi'], 'ã‚¸ãƒ£': ['zya', 'ja'], 'ã‚¸ãƒ¥': ['zyu', 'ju'], 'ã‚¸ãƒ§': ['zyo', 'jo'],
                'ãƒ²': ['o'], 'ãƒ³': ['n'], 'ãƒ‚': ['ji', 'di'], 'ãƒ…': ['zu', 'du'],
                'ãƒ´': ['vu'], 'ãƒ´ã‚¡': ['va'], 'ãƒ´ã‚£': ['vi'], 'ãƒ´ã‚§': ['ve'], 'ãƒ´ã‚©': ['vo']
            };
            if (alt[kana] && alt[kana].includes(val)) isCorrect = true;
        }

        if (isCorrect) {
            document.getElementById('feedback').innerText = 'Correct! âœ¨';
            document.getElementById('feedback').style.color = 'var(--accent-blue)';
            score++; document.getElementById('score-count').innerText = score;
            document.getElementById('answer-input').disabled = true;
            document.getElementById('check-btn').style.display = 'none';
            document.getElementById('next-btn').style.display = 'inline-block';
            document.getElementById('next-btn').focus();
            showTargetCell(true);
        } else {
            document.getElementById('feedback').innerText = 'Check the chartðŸ’¡';
            document.getElementById('feedback').style.color = '#ff6347';
            document.getElementById('answer-input').value = '';
            showTargetCell(true); 
        }
    }

    document.getElementById('answer-input').onkeydown = function(e) {
        if (e.key === 'Enter') {
            if (document.getElementById('next-btn').style.display === 'inline-block') nextQuestion();
            else check();
        }
    };

    // DOMContentLoadedã‚’ä½¿ã£ã¦ã€ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†æ™‚ã«ç¢ºå®Ÿã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸ
    document.addEventListener('DOMContentLoaded', () => {
        setMode('basic');
    });
</script>
</body>
</html>
